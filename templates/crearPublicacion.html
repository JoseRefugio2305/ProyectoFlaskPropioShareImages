{% extends 'layout.html' %}
{% block content %}
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


{% if datapub.0==0%}
<div class="col-md-10 offset-md-1">
    <div class="card card-body">
        <h3 class="card-tittle">Crear Publicacion</h3>
        <form action="/addPublication" method="POST" id="formPublication" enctype="multipart/form-data" >
            <div class="form-group" style="align-items: center;">
                <div class="row" style="justify-content: center;">
                    <img class="img-fluid"src="/static/img/upload2.png" id="imgpublication" alt="">
                </div>
                <div class="custom-file">
                    <input accept="image/png,image/jpeg,image/gif" required type="file" class="custom-file-input" id="inputGroupFile01" name="imgpublication" aria-describedby="inputGroupFileAddon01" >
                    <label class="custom-file-label" for="inputGroupFile01" style="text-align: left;">Subir Foto</label>
                </div>
                <div class="form-goup">
                    <h5 id="countcaracterstittle">Agrega un titulo (150)</h5>
                    <input class="form-control"type="text" id="tittle" name="tittle" maxlength="150" required placeholder="Agrega un titulo">
                </div>
                <div class="form-group">
                    <h6 id="countcaractersdescr">Agrega una descripcion (200)</h6>
                    <textarea class="form-control" required id="txtdescription" name="txtdescription" maxlength="200" cols="12" rows="5" placeholder="Agrega una descripcion"></textarea>
                    
                </div>
                
            </div>
        </form>
        <div class="form-group row" >
            <div class="col-md-6">
                <button class="btn btn-success form-control" onclick="ConfirmPublication()" disabled id="GuardarPublication">
                    Guardar
                </button>
            </div>
            <div class="col-md-6">
                <button class="btn btn-secondary form-control" disabled id="CancelarPublication" onclick="CancelAddPub()">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="col-md-10 offset-md-1">
    <div class="card card-body">
        <h3 class="card-tittle">Editar Publicacion</h3>
        <form action="/editPublication" method="POST" id="formPublicationEdit" enctype="multipart/form-data" >
            <input type="hidden" name="idpublicationedit" id="" value="{{datapub.0}}">
            <div class="form-group" style="align-items: center;">
                <div class="row" style="justify-content: center;">
                    <img class="img-fluid"src="/{{datapub.3}}" id="imgpublication" alt="">
                </div>
                <div class="custom-file">
                    <input accept="image/png,image/jpeg,image/gif" required type="file" class="custom-file-input" id="inputGroupFile01" name="imgpublication" aria-describedby="inputGroupFileAddon01" >
                    <label class="custom-file-label" for="inputGroupFile01" style="text-align: left;">Subir Foto</label>
                </div>
                <div class="form-group">
                    <h5 id="countcaracterstittle">Agrega un titulo (150)</h5>
                    <input class="form-control"type="text" id="tittle" name="tittle" maxlength="150" required placeholder="Agrega un titulo" value="{{datapub.1}}">
                </div>
                <div class="form-group">
                    <h6 id="countcaractersdescr">Agrega una descripcion (200)</h6>
                    <textarea class="form-control" id="txtdescription" name="txtdescription" maxlength="200" cols="12" rows="5" placeholder="Agrega una descripcion">{{datapub.2}}</textarea>
                </div>
                
            </div>
        </form>
        <div class="form-group row" >
            <div class="col-md-6">
                <button class="btn btn-success form-control" onclick="ConfirmPublicationEdit()" disabled id="GuardarPublication">
                    Guardar
                </button>
            </div>
            <div class="col-md-6">
                <button class="btn btn-secondary form-control" disabled id="CancelarPublication" onclick="CancelEdit('{{datapub.0}}')">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script>
    var modified=false;
    $(document).ready(function () 
    {   //esta parte ayuda a saber si alguno de los campos fue modificado para asi activar los botonoes de
        //guardar y cancelar
        var texto=document.getElementById('tittle').value;
        document.getElementById('countcaracterstittle').innerHTML="Agrega un titulo ("+(150-texto.length)+")";
        var texto=document.getElementById('txtdescription').value;
        document.getElementById('countcaractersdescr').innerHTML="Agrega una descripcion ("+(200-texto.length)+")";
        $("input, select, textarea").change(function () {   
            modified = true;
            document.getElementById("GuardarPublication").removeAttribute("disabled");
            document.getElementById("CancelarPublication").removeAttribute("disabled");
        }); 
    });
    $("#tittle").on('keyup', function(e){
        var texto=document.getElementById('tittle').value;
        document.getElementById('countcaracterstittle').innerHTML="Agrega un titulo ("+(150-texto.length)+")";
    });
    $("#txtdescription").on('keyup', function(e){
        var texto=document.getElementById('txtdescription').value;
        document.getElementById('countcaractersdescr').innerHTML="Agrega una descripcion ("+(200-texto.length)+")";
    });

    document.getElementById("inputGroupFile01").onchange = function(e) {
        // Creamos el objeto de la clase FileReader
        let reader = new FileReader();

        // Leemos el archivo subido y se lo pasamos a nuestro fileReader
        reader.readAsDataURL(e.target.files[0]);

        // Le decimos que cuando este listo ejecute el cÃ³digo interno
        reader.onload = function(){
            $('#imgpublication').attr("src",reader.result);
        };
        }
    function ConfirmPublication(){
        document.getElementById("formPublication").submit();
    }
    function ConfirmPublicationEdit(){
        Swal.fire({
            title: 'Estas seguro?',
            text: "Los Cambios en la publicacion seran guardados!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Confirmar',
            
            }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById("formPublicationEdit").submit();
            }
            });
    }
    function CancelEdit(idpub){
        Swal.fire({
            title: 'Estas seguro?',
            text: "Los cambios realizados no se llevaran a cabo",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Confirmar',
            
            }).then((result) => {
            if (result.isConfirmed) {
                window.location.href="/publication/"+idpub;
            }
            });
    }
    function CancelAddPub(){
        Swal.fire({
            title: 'Estas seguro?',
            text: "Los cambios realizados no se llevaran a cabo",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Confirmar',
            
            }).then((result) => {
            if (result.isConfirmed) {
                window.history.back();
            }
            });
    }
</script>

{% endblock %}